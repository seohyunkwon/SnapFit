<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.snapfit.model.dao.MemberDao">
<<<<<<< HEAD

=======
	
>>>>>>> 8e10c84053784300036ed377facd88c57e1ee5f9
	<!-- 회원 생성 -->
	<insert id="insertMember" parameterType="Member">
		INSERT INTO
		member
<<<<<<< HEAD
		(id,
		password, nickname, profile_img, birth_date, gender)
		values
		(#{id},
		#{password}, #{nickname}, #{profileImg}, #{birthDate}, #{gender})
	</insert>

	<!-- 아이디로 멤버 찾기 -->
	<select id="selectMember" parameterType="SearchCondition"
		resultType="Member">
		SELECT * FROM member
		<if test="key != null">
			WHERE ${key} = #{value}
		</if>
	</select>

	<!-- 회원정보 수정 -->
	<update id="updateMember" parameterType="Member">
		UPDATE member SET
		<if test="nickname != null">
			nickname=#{nickname}
		</if>
		<if
			test="nickname != null and (profileImg != null or password != null)">
=======
		(id, password, nickname, profile_img, birth_date, gender)
		values
		(#{id}, #{password}, #{nickname}, #{profileImg}, #{birthDate}, #{gender})
	</insert>
	
	<!-- 아이디로 멤버 찾기 -->
	<select id="selectMemberById" parameterType="String" resultType="Member">
		SELECT * FROM member WHERE id = #{id}
	</select>
	
	<!-- 회원번호로 멤버 찾기 -->
	<select id="selectMemberByNo" parameterType="long" resultType="Member">
		SELECT * FROM member WHERE no = #{no}
	</select>
	
	<!-- 회원정보 수정 -->
	<update id="updateMember" parameterType="Member">
		UPDATE member SET 
		<if test="nickname != null">
			nickname=#{nickname}
		</if>
		<if test="nickname != null and profileImg != null">
>>>>>>> 8e10c84053784300036ed377facd88c57e1ee5f9
			,
		</if>
		<if test="profileImg != null">
			profile_img=#{profileImg}
		</if>
<<<<<<< HEAD
		<if test="profileImg != null and password != null">
			,
		</if>
		<if test="password != null">
			password = #{password}
		</if>
		WHERE no = #{no}
	</update>

=======
		WHERE no = #{no}
	</update>
	
>>>>>>> 8e10c84053784300036ed377facd88c57e1ee5f9
	<!-- 회원 삭제 -->
	<delete id="deleteMember">
		DELETE FROM member WHERE no = #{no}
	</delete>
<<<<<<< HEAD


	<!-- 상위 3개 관심 운동이 같은 회원 리스트 -->
	<select id="selectMemberByExercise" parameterType="long" resultType="Member">
		SELECT * FROM member m WHERE m.no IN (SELECT v.uploader_no AS member_no
		FROM video v
		JOIN exercise e ON v.exercise_no = e.no
		WHERE v.exercise_no IN (
		SELECT * FROM (SELECT e.no
		FROM video v
		JOIN exercise e ON v.exercise_no = e.no
		WHERE v.uploader_no = #{memberNo}
		GROUP BY e.no
		ORDER BY COUNT(e.no) DESC
		LIMIT 3) as T
		)
		AND v.uploader_no != #{memberNo}
		GROUP BY v.uploader_no
		HAVING COUNT(DISTINCT v.exercise_no) = 3)
	</select>

=======
		
>>>>>>> 8e10c84053784300036ed377facd88c57e1ee5f9
</mapper>